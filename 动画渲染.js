function 游戏动画渲染(x){jsdh("游戏开始",(h,e)=>{ht(图片.游戏开始[~~(h*(图片.游戏开始.length-1))],0,0,1600,900,2,1,0,x)},h=>{初始发牌()}),jsdh("战斗开始",(h,e)=>{对战信息.我方回合?(ctx.save(),ctx.filter="hue-rotate(120deg)",ht(图片.战斗开始[~~(h*(图片.战斗开始.length-1))],0,0,1600,900,2,1,0,x),ctx.restore()):ht(图片.战斗开始[~~(h*(图片.战斗开始.length-1))],0,0,1600,900,2,1,0,x)},h=>{if(对战信息.我方回合=!对战信息.我方回合,摸牌(对战信息.我方回合),对战信息.我方回合)for(let h=0;h<对战信息.我方.场面.length;h++){var e=对战信息.我方.场面[h];0<e.当前血量&&触发被动效果(e.id,"回合开始")}else for(let h=0;h<对战信息.敌方.场面.length;h++){var t=对战信息.敌方.场面[h];0<t.当前血量&&触发被动效果(t.id,"回合开始")}对战信息.我方回合||setTimeout(AI出牌,sj(500,1500))}),jsdh("使用随从",(h,e)=>{var t=e.使用者.场面.length+1,d="我方"==e.使用者.名称?我方随从区域:敌方随从区域,i=Math.min(.618*d.h,d.w/7),t=d.x+(d.w-t*i-30*(t-1))/2+e.对象*(i+30),t=三D投影(t,d.y+.1*d.h,yinshe(h,0,1,-999,0));绘制卡牌(e.p,t.x,t.y,i*t.fd,.8*d.h*t.fd,x,!0,!1,"敌方"==e.使用者.名称),"敌方"==e.使用者.名称&&绘制卡牌(e.p,50,50,278,450,x,!0,!0,!0)},h=>{释放卡牌效果(h.p,h.使用者),h.使用者.场面.splice(h.对象,0,h.p)}),jsdh("获得指定牌",(h,e)=>{var t;e.我方&&(e=对战信息.我方.手牌.length+1,t=.618*我方手牌区域.h,e=我方手牌区域.x+(我方手牌区域.w-e*t-20*(e-1))/2+(e-1)*(20+t),ht(图片.获得卡牌[~~(h*(图片.获得卡牌.length-1))],e,我方手牌区域.y,t,我方手牌区域.h,3,1,0,x,!1,!1,!1,1.382))},h=>{var e=h.我方?对战信息.我方:对战信息.敌方;e.手牌.length<e.手牌上限&&e.手牌.push(h.p)}),jsdh("摸牌",(h,e)=>{var t,d,i,n,s=e.我方?对战信息.我方:对战信息.敌方;s.手牌.length<s.手牌上限&&0<s.牌组.length&&(t=e.我方?{x:1600-.618*我方头像区域.h,y:我方头像区域.y,w:.618*我方头像区域.h,h:我方头像区域.h}:{x:1600-.618*敌方头像区域.h,y:敌方头像区域.y,w:.618*敌方头像区域.h,h:敌方头像区域.h},d=e.我方?20:0,i=s.手牌.length+1,e=e.我方?我方手牌区域:敌方手牌区域,n=Math.min(.618*e.h,e.w/s.手牌上限),i=e.x+(e.w-i*n-(i-1)*d)/2+(i-1)*(n+d),d=yinshe(h,0,1,t.x,i),i=yinshe(h,0,1,t.y,e.y),n=yinshe(h,0,1,t.w,n),h=yinshe(h,0,1,t.h,e.h),绘制卡牌(s.牌组[0],d,i,n,h,x,!1))},h=>{var e=h.我方?对战信息.我方:对战信息.敌方;e.手牌.length<e.手牌上限&&0<e.牌组.length&&实际摸牌(h.我方,h.顺序摸)}),jsdh("随从攻击移动",(t,d)=>{d.p.移动中=!0;var i=获取随从位置(d.p.id),n=获取随从位置(d.p2.id);if(i&&n){let h,e;n=ffjz(n.左上坐标.x,n.左上坐标.y,n.左上坐标.w,n.左上坐标.h,i.左上坐标.w,i.左上坐标.h);e=t<.6?(h=hddh(t,.6,i.左上坐标.x,n.x,1),hddh(t,.6,i.左上坐标.y,n.y,1)):(h=yinshe(t,.6,1,n.x,i.左上坐标.x),yinshe(t,.6,1,n.y,i.左上坐标.y)),绘制卡牌(d.p,h,e,i.左上坐标.w,i.左上坐标.h,x,!0,!1,!i.友方随从)}},h=>{h.p.移动中=!1;var e=h.p,h=h.p2;造成伤害(e,h.当前攻击,h),造成伤害(h,e.当前攻击,e)}),jsdh("伤害治疗动画",(e,t)=>{var d=获取随从位置(t.id);if(d&&(0<t.数值||t.数值<0)){0<t.数值&&ht(8<=t.数值?图片.伤害背景大:图片.伤害背景,d.左上坐标.x,d.左上坐标.y,d.左上坐标.w,d.左上坐标.h,2,1,0,x,!1,!1,!1,yinshe(e,0,1,.8,yinshe(t.数值,1,12,1,2))),t.数值<0&&ht(图片.治疗背景,d.左上坐标.x,d.左上坐标.y,d.左上坐标.w,d.左上坐标.h,2,1,0,x,!1,!1,!1,yinshe(e,0,1,.8,yinshe(jdz(t.数值),1,12,1,2)));let h="-"+t.数值;8<=t.数值&&(h=`-${t.数值}!`),t.数值<0&&(h="+"+jdz(t.数值)),中心画字(7,h,d.左上坐标.x,d.左上坐标.y,d.左上坐标.w,d.左上坐标.h,x,!0,d.左上坐标.w/yinshe(jdz(t.数值),1,12,3,2))}},h=>{var e,h=获取随从位置(h.id);h&&((e=h.p).当前血量<=0&&"随从"==e.类型&&tjdh("随从死亡",.6,!0,5,{sc:h}),e.当前血量<=0)&&"英雄"==e.类型&&tjdh("英雄死亡",1,!0,5,{sc:h})}),jsdh("随从死亡",(h,e)=>{e=e.sc;let t=图片.死亡动画,d=3;"传说"==e.p.品质&&(d=4,t=图片.橙卡死亡动画),检测卡牌效果(e.p,"亡语")&&(d=4,t=图片.亡语_动画),ht(t[~~(h*(t.length-1))],e.左上坐标.x,e.左上坐标.y,e.左上坐标.w,e.左上坐标.h,2,1,0,x,!1,!1,!1,d)},h=>{var e=h.sc;if(触发被动效果(e.p.id,"死亡"),e.友方随从){for(let h=0;h<对战信息.我方.场面.length;h++)if(对战信息.我方.场面[h].id==e.p.id)return void 对战信息.我方.场面.splice(h,1)}else for(let h=0;h<对战信息.敌方.场面.length;h++)if(对战信息.敌方.场面[h].id==e.p.id)return void 对战信息.敌方.场面.splice(h,1)}),jsdh("英雄死亡",(h,e)=>{var e=e.sc,t=图片.英雄死亡;ht(t[~~(h*(t.length-1))],e.左上坐标.x,e.左上坐标.y,e.左上坐标.w,e.左上坐标.h,2,1,0,x,!1,!1,!1,15)},h=>{胜负判定()}),jsdh("无目标技能动画",(h,e)=>{var t,d=e.xg;d.不要动画||(t=图片[d.名称+"_动画"],d=d.缩放,ht(t[~~(h*(t.length-1))],0,0,1600,900,2,1,0,x,!1,!1,!1,d),"敌方"==e.使用者.名称&&绘制卡牌(e.p,50,50,278,450,x,!0,!0,!0))},h=>{实际执行效果(h)}),jsdh("指向技能动画",(h,e)=>{var t,d,i,n=e.xg,s=e.目标,y=图片[n.名称+"_动画"],l=n.缩放;n.弹道?(n="我方"==e.使用者.名称?e.指向法术手牌坐标:获取随从位置(e.使用者.id).中心坐标,t=s.中心坐标,d=xjd(n.x,n.y,t.x,t.y),i=hddh(h,1,n.x,t.x,1),n=hddh(h,1,n.y,t.y,1),ht(y[~~(h*(y.length-1))],i-100,n-100,200,200,2,1,d,x,!1,!1,!1,l)):ht(y[~~(h*(y.length-1))],s.左上坐标.x,s.左上坐标.y,s.左上坐标.w,s.左上坐标.h,2,1,0,x,!1,!1,!1,l),"敌方"==e.使用者.名称&&绘制卡牌(e.p,50,50,278,450,x,!0,!0,!0)},h=>{实际执行效果(h)}),jsdh("被动技能动画",(h,e)=>{var t,d,i=e.xg;i.不要动画||(t=图片[i.名称+"_动画"],i=i.缩放,d=获取随从位置(e.p.id)?.左上坐标||e.zb,ht(t[~~(h*(t.length-1))],d.x,d.y,d.w,d.h,2,1,0,x,!1,!1,!1,i),"敌方"==e.使用者.名称?绘制卡牌(e.p,50,50,278,450,x,!0,!0,!0):绘制卡牌(e.p,50,400,278,450,x,!0,!0,!1))},h=>{实际执行效果(h)})}